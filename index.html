<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JSON Search App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>

    <div class="container my-5 border border-dark rounded">
        <div class="row">
            <div class="col-md-6">
                <div class="my-3">
                    <button class="btn btn-primary h3" id="searchBtn">Extract Keys</button>
                    <textarea id="jsonInput" class="form-control" rows="15"
                        placeholder="To Find Keys That Contains vars"></textarea>
                </div>
                <div class="my-3">
                    <h3>Extracted Keys</h3>
                    <textarea id="extract-keys" class="form-control" rows="5"></textarea>
                </div>
            </div>
            <div class="col-md-6">
                <div class="my-3">
                    <h3>Search Extracted Keys In Response</h3>
                    <textarea id="response-data" class="form-control" rows="21"
                        placeholder="To Search Keys and Value In Response"></textarea>
                </div>
                <div class="text-center">
                    <button class="btn btn-primary" id="searchButton">Search</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h1>Found Keys</h1>
                <!-- <pre id="foundKeys" class="text-success"></pre> -->
                <table id="foundKeys" class="table table-bordered"></table>
            </div>
            <div class="col-md-6">
                <h1>Not Found Keys</h1>
                <!-- <pre id="notFoundKeys" class="text-danger"></pre> -->
                <table id="notFoundKeys" class="table table-bordered"></table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        // Function to deep search for `{vars{...}}` in keys and values
        function deepSearchForVars(obj, path = "") {
            const matches = [];
            // Recursive function to traverse JSON
            function traverse(currentObj, currentPath) {
                if (typeof currentObj === "object" && currentObj !== null) {
                    // Iterate over keys
                    for (const key in currentObj) {
                        const value = currentObj[key];
                        const newPath = currentPath ? `${currentPath}.${key}` : key;

                        // Check if key contains `{vars}`
                        if (key.includes("vars")) {
                            matches.push(newPath);
                        }

                        // Check if value is a string containing `{vars}`
                        if (typeof value === "string" && value.includes("vars")) {
                            matches.push(newPath);
                        }

                        // Recursively traverse for nested objects/arrays
                        traverse(value, newPath);
                    }
                } else if (Array.isArray(currentObj)) {
                    // Traverse arrays
                    currentObj.forEach((item, index) => {
                        traverse(item, `${currentPath}[${index}]`);
                    });
                }
            }

            traverse(obj, path); // Start traversal
            return matches;
        }

        // Event listener for the "Extract Keys" button
        document.getElementById("searchBtn").addEventListener("click", () => {
            const textarea = document.getElementById("jsonInput");
            const resultsDiv = document.getElementById("extract-keys");
            try {
                // Parse input JSON
                const jsonData = JSON.parse(textarea.value);
                // Perform deep search for keys containing `{vars}`
                const matches = deepSearchForVars(jsonData);

                // Display results
                if (matches.length === 0) {
                    resultsDiv.textContent = "No keys or values containing `{vars}` were found.";
                } else {
                    resultsDiv.textContent = matches.join("\n");
                }
            } catch (error) {
                resultsDiv.textContent = `Error: Invalid JSON input. ${error.message}`;
            }
        });

        // ------------------------
        function deepSearchKeys(obj, keysToSearch) {
            const foundKeys = [];
            const notFoundKeys = [...keysToSearch];

            function deepSearch(currentObj, currentPath = "") {
                if (typeof currentObj !== "object" || currentObj === null) return;

                for (const key in currentObj) {
                    const fullPath = currentPath ? `${currentPath}.${key}` : key;

                    // Check if the current path matches any of the keys to search
                    const index = notFoundKeys.findIndex(searchKey => searchKey === fullPath);
                    if (index !== -1) {
                        // Add both key and value to the foundKeys array
                        foundKeys.push({ key: fullPath, value: currentObj[key] });
                        notFoundKeys.splice(index, 1); // Remove from notFoundKeys
                    }

                    // Recurse into nested objects
                    deepSearch(currentObj[key], fullPath);
                }
            }

            deepSearch(obj);

            return {
                foundKeys,
                notFoundKeys,
            };
        }
        document.getElementById("searchButton").addEventListener("click", () => {
            // Fetch response data from the textarea
            const responseData = document.getElementById("response-data").value;
            let responseObject;
            try {
                responseObject = JSON.parse(responseData); // Parse JSON from textarea
            } catch (error) {
                alert("Invalid JSON in response data!");
                return;
            }

            // Fetch keys to search from the textarea
            const keysTextarea = document.getElementById("extract-keys").value;

            // Ensure keys are clean and ready for comparison
            const keysToSearch = keysTextarea
                .split("\n")
                .map(key => key.trim())
                .filter(key => key !== ""); // Remove empty lines

            if (keysToSearch.length === 0) {
                alert("No keys to search. Extract keys first!");
                return;
            }

            // Perform the deep search
            const result = deepSearchKeys(responseObject, keysToSearch);

            // Render found keys as a table
            const foundKeysTable = document.getElementById("foundKeys");
            foundKeysTable.innerHTML = ""; // Clear previous results

            // Create table header
            const tableHeader = document.createElement("thead");
            const headerRow = document.createElement("tr");
            const headerKey = document.createElement("th");
            headerKey.textContent = "Key";
            const headerValue = document.createElement("th");
            headerValue.textContent = "Value";
            headerRow.appendChild(headerKey);
            headerRow.appendChild(headerValue);
            tableHeader.appendChild(headerRow);

            // Create table body
            const tableBody = document.createElement("tbody");
            result.foundKeys.forEach(item => {
                const row = document.createElement("tr");

                const keyCell = document.createElement("td");
                keyCell.textContent = item.key;

                const valueCell = document.createElement("td");
                valueCell.textContent = item.value;

                row.appendChild(keyCell);
                row.appendChild(valueCell);

                tableBody.appendChild(row);
            });

            foundKeysTable.appendChild(tableHeader);
            foundKeysTable.appendChild(tableBody);

            // Render not found keys as a list
            const notFoundKeysList = document.getElementById("notFoundKeys");
            notFoundKeysList.innerHTML = ""; // Clear previous list
            const ul = document.createElement("ul"); // Create unordered list

            result.notFoundKeys.forEach(key => {
                const li = document.createElement("li"); // Create list item
                li.textContent = key; // Set the text to the not found key
                ul.appendChild(li); // Append list item to the unordered list
            });

            notFoundKeysList.appendChild(ul); // Append the unordered list to the container
        });

    </script>

</body>

</html>
