<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JSON Search App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>

    <div class="container my-5 border border-dark rounded">
        <div class="row">
            <div class="col-md-6">
                <div class="my-3">
                    <button class="btn btn-primary h3" id="searchBtn">Extract Keys</button>
                    <textarea id="jsonInput" class="form-control" rows="15"
                        placeholder="To Find Keys That Contains vars"></textarea>
                </div>
                <div class="my-3">
                    <h3>Extracted Keys</h3>
                    <textarea id="extract-keys" class="form-control" rows="5"></textarea>
                </div>
            </div>
            <div class="col-md-6">
                <div class="my-3">
                    <h3>Search Extracted Keys In Response</h3>
                    <textarea id="response-data" class="form-control" rows="21"
                        placeholder="To Search Keys and Value In Response"></textarea>
                </div>
                <div class="text-center">
                    <button class="btn btn-primary" id="searchButton">Search</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h1>Found Keys</h1>
                <p id="foundKeys" class="text-success"></p>
            </div>
            <div class="col-md-6">
                <h1>Not Found Keys</h1>
                <p id="notFoundKeys" class="text-danger"></p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        // Function to deep search for `{vars{...}}` in keys and values
        function deepSearchForVars(obj, path = "") {
            const matches = [];

            // Recursive function to traverse JSON
            function traverse(currentObj, currentPath) {
                if (typeof currentObj === "object" && currentObj !== null) {
                    // Iterate over keys
                    for (const key in currentObj) {
                        const value = currentObj[key];
                        const newPath = currentPath ? `${currentPath}.${key}` : key;

                        // Check if key contains `{vars}`
                        if (key.includes("{vars{")) {
                            //matches.push({ path: newPath, type: "key", match: key });
                            matches.push(newPath);
                        }

                        // Check if value is a string containing `{vars}`
                        if (typeof value === "string" && value.includes("{vars{")) {
                            //matches.push({ path: newPath, type: "value", match: value });
                            matches.push(newPath);
                        }

                        // Recursively traverse for nested objects/arrays
                        traverse(value, newPath);
                    }
                } else if (Array.isArray(currentObj)) {
                    // Traverse arrays
                    currentObj.forEach((item, index) => {
                        traverse(item, `${currentPath}[${index}]`);
                    });
                }
            }

            traverse(obj, path); // Start traversal
            return matches;
        }
        // Event listener for the search button
        document.getElementById("searchBtn").addEventListener("click", () => {
            const textarea = document.getElementById("jsonInput");
            const resultsDiv = document.getElementById("extract-keys");
            try {
                // Parse input JSON
                const jsonData = JSON.parse(textarea.value);
                // Perform deep search
                const matches = deepSearchForVars(jsonData);

                // Display results
                if (matches.length === 0) {
                    resultsDiv.textContent = "No keys or values containing `{vars}` were found.";
                } else {
                    resultsDiv.textContent = JSON.stringify(matches, null, 2);
                }
            } catch (error) {
                resultsDiv.textContent = `Error: Invalid JSON input. ${error.message}`;
            }
        });
        // ------------------------
        function deepSearchKeys(obj, keysToSearch) {
            const foundKeys = [];
            const notFoundKeys = [...keysToSearch];
            function deepSearch(currentObj, currentPath = "") {
                if (typeof currentObj !== "object" || currentObj === null) return;

                for (const key in currentObj) {
                    const fullPath = currentPath ? `${currentPath}.${key}` : key;

                    // Check if the current path matches any of the keys to search
                    const index = notFoundKeys.indexOf(fullPath);
                    if (index !== -1) {
                        foundKeys.push(fullPath);
                        notFoundKeys.splice(index, 1); // Remove found key from notFoundKeys
                    }

                    // Recurse into nested objects
                    deepSearch(currentObj[key], fullPath);
                }
            }

            deepSearch(obj);

            return {
                foundKeys,
                notFoundKeys,
            };
        }
        // -------------
        document.getElementById("searchButton").addEventListener("click", () => {
            // Fetch response data from the textarea
            const responseData = document.getElementById("response-data").value;
            let responseObject;
            try {
                responseObject = JSON.parse(responseData); // Parse JSON from textarea
            } catch (error) {
                alert("Invalid JSON in response data!");
                return;
            }

            // Fetch keys to search from the textarea
            const keysTextarea = document.getElementById("extract-keys").value;
            const keysToSearch = keysTextarea.split("\n").map(key => key.trim()).filter(key => key !== "");

            // Perform the deep search
            const result = deepSearchKeys(responseObject, keysToSearch);

            // Display results in the UI
            document.getElementById("foundKeys").textContent = result.foundKeys.join(", ");
            document.getElementById("notFoundKeys").textContent = result.notFoundKeys.join(", ");
        });
    </script>

</body>

</html>
